# ğŸš€ AirAccount TEEé¡¹ç›®æ–°å¼€å‘è€…å®Œæ•´å…¥é—¨æŒ‡å—

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æŒ‡å—æ˜¯ä¸ºåŠ å…¥AirAccount TEEé¡¹ç›®çš„æ–°å¼€å‘è€…å‡†å¤‡çš„å®Œæ•´å…¥é—¨æ•™ç¨‹ã€‚é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•ï¼š
- ç†è§£é¡¹ç›®æ¶æ„å’ŒæŠ€æœ¯æ ˆ
- æ­å»ºå®Œæ•´çš„å¼€å‘ç¯å¢ƒ
- ä½¿ç”¨QEMUå’ŒDockeræ¨¡æ‹ŸçœŸå®TEEç¡¬ä»¶
- ç¼–è¯‘ã€è¿è¡Œå’Œæµ‹è¯•CAï¼ˆå®¢æˆ·ç«¯åº”ç”¨ï¼‰å’ŒTAï¼ˆå¯ä¿¡åº”ç”¨ï¼‰
- è¿›è¡Œæ—¥å¸¸å¼€å‘å’Œè°ƒè¯•å·¥ä½œ

## ğŸ¯ å­¦ä¹ è·¯å¾„

### é˜¶æ®µ1ï¼šç†è®ºåŸºç¡€ (1-2å¤©)
- [é¡¹ç›®æ¶æ„ç†è§£](#é¡¹ç›®æ¶æ„ç†è§£)
- [TEEå’ŒOP-TEEåŸºç¡€çŸ¥è¯†](#teeå’Œop-teeåŸºç¡€çŸ¥è¯†)

### é˜¶æ®µ2ï¼šç¯å¢ƒæ­å»º (1å¤©)
- [å¼€å‘ç¯å¢ƒé…ç½®](#å¼€å‘ç¯å¢ƒé…ç½®)
- [QEMUæ¨¡æ‹Ÿç¯å¢ƒè®¾ç½®](#qemuæ¨¡æ‹Ÿç¯å¢ƒè®¾ç½®)

### é˜¶æ®µ3ï¼šå®è·µæ“ä½œ (2-3å¤©)
- [ç¬¬ä¸€ä¸ªæµ‹è¯•è¿è¡Œ](#ç¬¬ä¸€ä¸ªæµ‹è¯•è¿è¡Œ)
- [æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•](#æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•)
- [ä»£ç ä¿®æ”¹å’Œè°ƒè¯•](#ä»£ç ä¿®æ”¹å’Œè°ƒè¯•)

### é˜¶æ®µ4ï¼šåŠ å…¥å¼€å‘ (æŒç»­)
- [å¼€å‘å·¥ä½œæµç¨‹](#å¼€å‘å·¥ä½œæµç¨‹)
- [ä»£ç è´¡çŒ®æŒ‡å—](#ä»£ç è´¡çŒ®æŒ‡å—)

---

## ğŸ—ï¸ é¡¹ç›®æ¶æ„ç†è§£

### æ ¸å¿ƒæ¦‚å¿µ

**AirAccount**æ˜¯ä¸€ä¸ªåŸºäºTEEï¼ˆå¯ä¿¡æ‰§è¡Œç¯å¢ƒï¼‰çš„è·¨å¹³å°Web3è´¦æˆ·ç³»ç»Ÿï¼Œä¸»è¦ç‰¹ç‚¹ï¼š

- **ç¡¬ä»¶çº§å®‰å…¨**ï¼šç§é’¥å­˜å‚¨åœ¨TEEå®‰å…¨å­˜å‚¨ä¸­ï¼Œnever leave TEE
- **åŒé‡ç­¾åæœºåˆ¶**ï¼šå®¢æˆ·ç«¯+TEEåŒé‡ç­¾åä¿è¯äº¤æ˜“å®‰å…¨
- **è·¨å¹³å°æ”¯æŒ**ï¼šæ”¯æŒARM TrustZoneï¼ˆRaspberry Piï¼‰å’ŒIntel SGX
- **æ¸è¿›å¼å»ä¸­å¿ƒåŒ–**ï¼šä»ä¸­å¿ƒåŒ–MVPåˆ°å®Œå…¨å»ä¸­å¿ƒåŒ–ç½‘ç»œ

### æŠ€æœ¯æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ç”¨æˆ·åº”ç”¨å±‚                              â”‚
â”‚  (Tauriå®¢æˆ·ç«¯ + Webå‰ç«¯ + dApp SDK)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Core Logicå±‚                          â”‚
â”‚  (ç¡¬ä»¶æ— å…³çš„Rustä¸šåŠ¡é€»è¾‘ - 90%ä»£ç å¤ç”¨)                       â”‚
â”‚  â€¢ é’±åŒ…ç®¡ç†  â€¢ ç­¾åé€»è¾‘  â€¢ å®‰å…¨æ¨¡å—  â€¢ ç½‘ç»œé€šä¿¡                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   TEEé€‚é…å±‚                             â”‚
â”‚  Platform-specific TEE wrappers                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    ARM TrustZone    â”‚         Intel SGX                 â”‚
â”‚   (OP-TEE)         â”‚        (SGX SDK)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç¡¬ä»¶TEEå±‚                              â”‚
â”‚     Raspberry Pi 5      â”‚        Intel Processors      â”‚
â”‚     (ARM TrustZone)     â”‚         (SGX Enabled)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®ç»„ä»¶è¯´æ˜

| ç»„ä»¶ | æè¿° | ä½ç½® |
|------|------|------|
| **TA (Trusted Application)** | è¿è¡Œåœ¨TEEä¸­çš„å¯ä¿¡åº”ç”¨ï¼Œå¤„ç†ç§é’¥å’Œç­¾å | `packages/ta-arm-trustzone/` |
| **CA (Client Application)** | è¿è¡Œåœ¨æ™®é€šä¸–ç•Œçš„å®¢æˆ·ç«¯ï¼Œä¸TAé€šä¿¡ | `packages/client-ca/` |
| **Core Logic** | ç¡¬ä»¶æ— å…³çš„ä¸šåŠ¡é€»è¾‘åº“ | `packages/core-logic/` |
| **Teaclave SDK** | Apache Teaclave TrustZone SDK | `third_party/incubator-teaclave-trustzone-sdk/` |

---

## ğŸ§  TEEå’ŒOP-TEEåŸºç¡€çŸ¥è¯†

### TEEæ ¸å¿ƒæ¦‚å¿µ

**å¯ä¿¡æ‰§è¡Œç¯å¢ƒï¼ˆTEEï¼‰**æ˜¯å¤„ç†å™¨ç¡¬ä»¶æä¾›çš„å®‰å…¨åŒºåŸŸï¼š

- **Secure Worldï¼ˆå®‰å…¨ä¸–ç•Œï¼‰**ï¼šè¿è¡Œå¯ä¿¡åº”ç”¨(TA)ï¼Œå¤„ç†æ•æ„Ÿæ•°æ®
- **Normal Worldï¼ˆæ™®é€šä¸–ç•Œï¼‰**ï¼šè¿è¡Œå¸¸è§„åº”ç”¨(CA)ï¼Œé€šè¿‡å®‰å…¨ç›‘æ§å™¨ä¸TEEé€šä¿¡
- **ç¡¬ä»¶éš”ç¦»**ï¼šå†…å­˜ã€å¯„å­˜å™¨ã€ä¸­æ–­å®Œå…¨éš”ç¦»
- **å®‰å…¨å­˜å‚¨**ï¼šç¡¬ä»¶åŠ å¯†çš„æŒä¹…åŒ–å­˜å‚¨

### OP-TEEæ¶æ„

OP-TEEæ˜¯å¼€æºçš„TEEå®ç°ï¼Œå¹¿æ³›ç”¨äºARMå¹³å°ï¼š

```
Normal World                    Secure World
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Linux Kernel  â”‚            â”‚    OP-TEE OS    â”‚
â”‚                 â”‚            â”‚                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚            â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚     CA      â”‚â—„â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â–ºâ”‚     TA      â”‚ â”‚
â”‚ â”‚(airaccount- â”‚ â”‚            â”‚ â”‚(airaccount. â”‚ â”‚
â”‚ â”‚    ca)      â”‚ â”‚            â”‚ â”‚    ta)      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚            â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                 â”‚            â”‚                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚            â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  libteec    â”‚ â”‚  SMC Call  â”‚ â”‚ OP-TEE Core â”‚ â”‚
â”‚ â”‚   (TEE      â”‚â—„â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â–ºâ”‚  Services   â”‚ â”‚
â”‚ â”‚  Client)    â”‚ â”‚            â”‚ â”‚             â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚            â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ARM TrustZone â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®APIå’Œæ¦‚å¿µ

- **TEEC_***: TEEå®¢æˆ·ç«¯APIï¼ŒCAä½¿ç”¨
- **TEE_***: TEEå†…éƒ¨APIï¼ŒTAä½¿ç”¨  
- **UUID**: æ¯ä¸ªTAæœ‰å”¯ä¸€æ ‡è¯†ç¬¦
- **Session**: CAä¸ç‰¹å®šTAçš„é€šä¿¡ä¼šè¯
- **Command**: CAå‘TAå‘é€çš„å…·ä½“æ“ä½œè¯·æ±‚

---

## ğŸ› ï¸ å¼€å‘ç¯å¢ƒé…ç½®

### ç³»ç»Ÿè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: macOS (æ¨è), Ubuntu 20.04+, æˆ– Windows WSL2
- **ç¡¬ç›˜ç©ºé—´**: è‡³å°‘30GBå¯ç”¨ç©ºé—´
- **å†…å­˜**: è‡³å°‘8GBï¼ˆæ¨è16GB+ï¼‰
- **å¤„ç†å™¨**: x64æ¶æ„ï¼Œæ”¯æŒè™šæ‹ŸåŒ–

### å¿…å¤‡å·¥å…·å®‰è£…

#### macOSç¯å¢ƒï¼ˆæ¨èï¼‰
```bash
# 1. å®‰è£… Homebrew (å¦‚æœè¿˜æ²¡æœ‰)
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# 2. å®‰è£…å¿…è¦å·¥å…·
brew install git curl qemu docker rust

# 3. å®‰è£…Xcodeå‘½ä»¤è¡Œå·¥å…·
xcode-select --install

# 4. éªŒè¯å®‰è£…
qemu-system-aarch64 --version
docker --version
rustc --version
```

#### Ubuntuç¯å¢ƒ
```bash
# 1. æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# 2. å®‰è£…å¼€å‘å·¥å…·
sudo apt install -y \
    build-essential \
    git curl \
    qemu-system-arm \
    docker.io \
    python3 python3-pip \
    uuid-dev libssl-dev

# 3. å®‰è£…Rust
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
source ~/.bashrc
```

### é¡¹ç›®å…‹éš†å’Œåˆå§‹åŒ–

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/your-org/AirAccount.git
cd AirAccount

# 2. åˆå§‹åŒ–Gitå­æ¨¡å—ï¼ˆé‡è¦ï¼ï¼‰
git submodule update --init --recursive

# 3. éªŒè¯å­æ¨¡å—çŠ¶æ€
git submodule status

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
# +commit_hash third_party/incubator-teaclave-trustzone-sdk (tag)
```

### ç¯å¢ƒå˜é‡é…ç½®

```bash
# 1. è®¾ç½®é¡¹ç›®ç¯å¢ƒå˜é‡
export AIRACCOUNT_ROOT=$(pwd)
export OPTEE_DIR="$AIRACCOUNT_ROOT/third_party/incubator-teaclave-trustzone-sdk"

# 2. æ·»åŠ åˆ°shellé…ç½®æ–‡ä»¶ï¼ˆå¯é€‰ä½†æ¨èï¼‰
echo "export AIRACCOUNT_ROOT=$AIRACCOUNT_ROOT" >> ~/.bashrc
echo "export OPTEE_DIR=$OPTEE_DIR" >> ~/.bashrc
source ~/.bashrc
```

---

## ğŸ–¥ï¸ QEMUæ¨¡æ‹Ÿç¯å¢ƒè®¾ç½®

AirAccountæ”¯æŒé€šè¿‡QEMUå®Œå…¨æ¨¡æ‹ŸARM+OP-TEEç¯å¢ƒï¼Œæ— éœ€çœŸå®ç¡¬ä»¶å³å¯å¼€å‘å’Œæµ‹è¯•ã€‚

### QEMUç¯å¢ƒçš„ä¼˜åŠ¿

âœ… **é›¶ç¡¬ä»¶ä¾èµ–**ï¼šåœ¨ä»»ä½•x64æœºå™¨ä¸Šå¼€å‘ARM TEEåº”ç”¨  
âœ… **å¿«é€Ÿè¿­ä»£**ï¼šç¼–è¯‘åç«‹å³æµ‹è¯•ï¼Œæ— éœ€çƒ§å½•å›ºä»¶  
âœ… **å®Œå…¨éš”ç¦»**ï¼šä¸ä¼šå½±å“ä¸»æœºç³»ç»Ÿ  
âœ… **è°ƒè¯•å‹å¥½**ï¼šæ”¯æŒGDBè°ƒè¯•å’Œæ—¥å¿—è¾“å‡º  
âœ… **CI/CDå°±ç»ª**ï¼šé€‚åˆè‡ªåŠ¨åŒ–æµ‹è¯•å’ŒæŒç»­é›†æˆ

### OP-TEE QEMUç¯å¢ƒç»„ä»¶

æˆ‘ä»¬ä½¿ç”¨çš„QEMUç¯å¢ƒåŒ…å«ï¼š

```
QEMUè™šæ‹Ÿæœºç»„æˆ:
â”œâ”€â”€ ARM Trusted Firmware (ATF)     - å¯åŠ¨åŠ è½½å™¨
â”œâ”€â”€ OP-TEE OS                      - å®‰å…¨ä¸–ç•Œæ“ä½œç³»ç»Ÿ  
â”œâ”€â”€ U-Boot                         - å¼•å¯¼åŠ è½½å™¨
â”œâ”€â”€ Linux Kernel (Ubuntu 24.04)   - æ™®é€šä¸–ç•Œæ“ä½œç³»ç»Ÿ
â”œâ”€â”€ Root FileSystem               - åŒ…å«æµ‹è¯•å·¥å…·å’Œåº“
â””â”€â”€ Shared Directory (9P virtio)  - ä¸»æœºä¸è™šæ‹Ÿæœºæ–‡ä»¶å…±äº«
```

### é¢„æ„å»ºé•œåƒéªŒè¯

```bash
# 1. è¿›å…¥æµ‹è¯•ç›®å½•
cd third_party/incubator-teaclave-trustzone-sdk/tests

# 2. æ£€æŸ¥é¢„æ„å»ºçš„OP-TEEé•œåƒ
ls -la aarch64-optee-4.7.0-qemuv8-ubuntu-24.04/
# åº”è¯¥çœ‹åˆ°ï¼š
# bl1.bin, bl2.bin, bl31.bin, bl32.bin (TEEç»„ä»¶)
# Image, rootfs.cpio.gz (Linuxç»„ä»¶)
# qemu-system-aarch64 (QEMUäºŒè¿›åˆ¶æ–‡ä»¶)

# 3. éªŒè¯QEMUå¯åŠ¨è„šæœ¬
cat optee-qemuv8-fixed.sh
```

### ç¬¬ä¸€æ¬¡QEMUå¯åŠ¨æµ‹è¯•

```bash
# 1. å¯åŠ¨QEMU OP-TEEç¯å¢ƒ
cd third_party/incubator-teaclave-trustzone-sdk/tests
./optee-qemuv8-fixed.sh aarch64-optee-4.7.0-qemuv8-ubuntu-24.04

# 2. ç­‰å¾…å¯åŠ¨å®Œæˆï¼ˆçº¦30-60ç§’ï¼‰
# æ‚¨ä¼šçœ‹åˆ°å¯åŠ¨æ—¥å¿—ï¼š
# ...
# [    0.000000] Booting Linux on physical CPU 0x0
# ...
# OP-TEE core start...
# ...
# buildroot login: 

# 3. ä½¿ç”¨rootç™»å½•ï¼ˆæ— å¯†ç ï¼‰
root

# 4. éªŒè¯TEEç¯å¢ƒ
root@buildroot:~# ls /lib/optee_armtz/
# åº”è¯¥ä¸ºç©ºæˆ–æœ‰ä¸€äº›.taæ–‡ä»¶

root@buildroot:~# ps aux | grep tee
# åº”è¯¥çœ‹åˆ°tee-supplicantè¿›ç¨‹è¿è¡Œä¸­
```

### å…±äº«ç›®å½•è®¾ç½®

QEMUä½¿ç”¨9P virtioæ–‡ä»¶ç³»ç»Ÿå®ç°ä¸»æœºä¸è™šæ‹Ÿæœºçš„æ–‡ä»¶å…±äº«ï¼š

```bash
# åœ¨QEMUè™šæ‹Ÿæœºå†…æ‰§è¡Œï¼š

# 1. åˆ›å»ºæŒ‚è½½ç‚¹
root@buildroot:~# mkdir -p /shared

# 2. æŒ‚è½½å…±äº«ç›®å½•
root@buildroot:~# mount -t 9p -o trans=virtio host /shared

# 3. éªŒè¯æŒ‚è½½
root@buildroot:~# ls /shared/
# è¿™é‡Œä¼šæ˜¾ç¤ºä¸»æœº tests/shared/ ç›®å½•çš„å†…å®¹

# 4. æµ‹è¯•æ–‡ä»¶ä¼ è¾“
root@buildroot:~# echo "hello from qemu" > /shared/test.txt
# ç„¶ååœ¨ä¸»æœº tests/shared/test.txt æŸ¥çœ‹æ­¤æ–‡ä»¶
```

### QEMUç¯å¢ƒæ€§èƒ½è°ƒä¼˜

```bash
# ä¼˜åŒ–QEMUæ€§èƒ½çš„å¯åŠ¨å‚æ•°è¯´æ˜ï¼š

-smp 2                    # åŒæ ¸CPUï¼Œæå‡æ€§èƒ½
-m 1057                   # 1GBå†…å­˜ï¼Œè¶³å¤Ÿè¿è¡Œæµ‹è¯•
-machine virt,secure=on   # å¯ç”¨TrustZoneå®‰å…¨æ‰©å±•
-cpu cortex-a57           # é«˜æ€§èƒ½ARMv8 CPU
-nographic               # æ— å›¾å½¢ç•Œé¢ï¼Œæå‡æ€§èƒ½
```

---

## ğŸ§ª ç¬¬ä¸€ä¸ªæµ‹è¯•è¿è¡Œ

### Hello Worldç¤ºä¾‹æµ‹è¯•

```bash
# 1. æ„å»ºHello Worldç¤ºä¾‹
cd $AIRACCOUNT_ROOT
cd third_party/incubator-teaclave-trustzone-sdk/examples/hello_world-rs

# 2. æ„å»ºTAå’ŒCA
make

# 3. å¤åˆ¶æ„å»ºäº§ç‰©åˆ°å…±äº«ç›®å½•
cp ta/target/aarch64-unknown-optee/release/*.ta ../../../tests/shared/
cp host/target/aarch64-unknown-linux-gnu/release/hello_world-rs ../../../tests/shared/hello-ca

# 4. å¯åŠ¨QEMUï¼ˆå¦‚æœè¿˜æ²¡å¯åŠ¨ï¼‰
cd ../../../tests
./optee-qemuv8-fixed.sh aarch64-optee-4.7.0-qemuv8-ubuntu-24.04

# 5. åœ¨QEMUä¸­æµ‹è¯•
root@buildroot:~# mount -t 9p -o trans=virtio host /shared
root@buildroot:~# cd /shared

# 6. å®‰è£…TA
root@buildroot:/shared# cp *.ta /lib/optee_armtz/

# 7. è¿è¡ŒCAæµ‹è¯•
root@buildroot:/shared# chmod +x hello-ca
root@buildroot:/shared# ./hello-ca
# åº”è¯¥çœ‹åˆ°æˆåŠŸè¾“å‡ºï¼š
# Invoking TA to increment 42
# TA incremented value to 43
```

### AirAccountæ ¸å¿ƒåŠŸèƒ½æµ‹è¯•

ç°åœ¨æµ‹è¯•æˆ‘ä»¬çš„æ ¸å¿ƒAirAccountåŠŸèƒ½ï¼š

```bash
# 1. æ„å»ºAirAccount TAå’ŒCA
cd $AIRACCOUNT_ROOT

# 2. æ„å»ºCore Logicåº“
cd packages/core-logic
cargo test --all-features  # è¿è¡Œå•å…ƒæµ‹è¯•
cargo build --release      # æ„å»ºå‘å¸ƒç‰ˆæœ¬

# 3. æ„å»ºTAï¼ˆå¦‚æœå­˜åœ¨ï¼‰
# cd packages/ta-arm-trustzone
# make

# 4. æ„å»ºCAï¼ˆå¦‚æœå­˜åœ¨ï¼‰  
# cd packages/client-ca
# make

# æ³¨æ„ï¼šå½“å‰é¡¹ç›®é‡ç‚¹åœ¨Core Logicå±‚ï¼ŒTA/CAå¯èƒ½è¿˜åœ¨å¼€å‘ä¸­
```

### é¢„ç½®æµ‹è¯•è„šæœ¬è¿è¡Œ

é¡¹ç›®æä¾›äº†å¤šä¸ªæµ‹è¯•è„šæœ¬ï¼š

```bash
# 1. ETHé’±åŒ…åŠŸèƒ½æµ‹è¯•
cd third_party/incubator-teaclave-trustzone-sdk/tests
./test_eth_wallet.sh

# 2. AirAccountä¸“ç”¨æµ‹è¯•
./test_airaccount.sh

# 3. å®Œæ•´çš„åŠ å¯†å’Œç­¾åæµ‹è¯•
./test_authentication.sh
./test_signature_verification.sh

# 4. æŸ¥çœ‹æµ‹è¯•è¾“å‡º
tail -f test_output.log
```

---

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•

### é’±åŒ…ç®¡ç†åŠŸèƒ½æµ‹è¯•

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
cd packages/core-logic

# 1. è¿è¡Œé’±åŒ…æ ¸å¿ƒæµ‹è¯•
cargo test wallet::core_wallet::tests::test_wallet_creation -- --nocapture

# 2. è¿è¡Œå¢å¼ºé’±åŒ…ç®¡ç†æµ‹è¯•  
cargo test wallet::enhanced_wallet_manager::tests::test_enhanced_wallet_creation -- --nocapture

# 3. è¿è¡Œåœ°å€æ´¾ç”Ÿæµ‹è¯•
cargo test wallet::core_wallet::tests::test_address_checksum -- --nocapture
```

### å®‰å…¨æ¨¡å—æµ‹è¯•

```bash
# 1. å†…å­˜ä¿æŠ¤æµ‹è¯•
cargo test security::memory_protection::tests::test_secure_memory -- --nocapture

# 2. å¯†é’¥æ´¾ç”Ÿæµ‹è¯•
cargo test security::key_derivation::tests::test_key_derivation -- --nocapture

# 3. å®‰å…¨å¯åŠ¨æµ‹è¯•
cargo test security::secure_boot::tests::test_secure_boot_manager -- --nocapture

# 4. å®¡è®¡ç³»ç»Ÿæµ‹è¯•
cargo test security::audit::tests::test_audit_logger -- --nocapture
```

### åŠ å¯†å’Œç­¾åæµ‹è¯•

```bash
# 1. å¸¸é‡æ—¶é—´æ“ä½œæµ‹è¯•
cargo test security::constant_time::tests::test_constant_time_ops_secure_compare -- --nocapture

# 2. SIMDå®‰å…¨æ“ä½œæµ‹è¯•
cargo test security::simd_ops::tests::test_simd_secure_compare -- --nocapture

# 3. ç†µæ”¶é›†å’Œéšæœºæ•°æµ‹è¯•
cargo test security::entropy::tests::test_hardware_rng_availability -- --nocapture
```

### å®Œæ•´æµ‹è¯•å¥—ä»¶

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼ˆéœ€è¦å‡ åˆ†é’Ÿï¼‰
cargo test --all-features

# åªè¿è¡Œé€šè¿‡çš„æµ‹è¯•
cargo test --all-features -- --skip test_statistics

# ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
cargo test --all-features -- --format json > test_results.json
```

---

## ğŸ› ä»£ç ä¿®æ”¹å’Œè°ƒè¯•

### å¼€å‘å·¥ä½œæµç¨‹

#### 1. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯

```bash
# 1. ä»mainåˆ†æ”¯åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout main
git pull origin main
git checkout -b feature/your-feature-name

# 2. æŸ¥çœ‹å½“å‰åˆ†æ”¯çŠ¶æ€
git status
```

#### 2. ä»£ç ä¿®æ”¹ç¤ºä¾‹

è®©æˆ‘ä»¬å°è¯•æ·»åŠ ä¸€ä¸ªç®€å•çš„æ–°åŠŸèƒ½ï¼š

```bash
# 1. åœ¨core-logicä¸­æ·»åŠ æ–°åŠŸèƒ½
cd packages/core-logic/src

# 2. åˆ›å»ºæ–°çš„æµ‹è¯•æ¨¡å—
cat > tests/new_feature_test.rs << 'EOF'
//! æ–°åŠŸèƒ½æµ‹è¯•ç¤ºä¾‹

use crate::security::SecurityError;

#[derive(Debug)]
pub struct NewFeature {
    name: String,
}

impl NewFeature {
    pub fn new(name: &str) -> Self {
        Self {
            name: name.to_string(),
        }
    }
    
    pub fn get_name(&self) -> &str {
        &self.name
    }
}

#[cfg(test)]
mod tests {
    use super::*;
    
    #[test]
    fn test_new_feature_creation() {
        let feature = NewFeature::new("test");
        assert_eq!(feature.get_name(), "test");
    }
}
EOF

# 3. å°†æ–°æ¨¡å—æ·»åŠ åˆ°lib.rs
echo "pub mod new_feature_test;" >> lib.rs
```

#### 3. è¿è¡Œæµ‹è¯•éªŒè¯

```bash
# 1. è¿è¡Œæ–°åŠŸèƒ½æµ‹è¯•
cargo test new_feature_test

# 2. è¿è¡Œæ‰€æœ‰æµ‹è¯•ç¡®ä¿æ²¡æœ‰å›å½’
cargo test --all-features

# 3. æ£€æŸ¥ä»£ç æ ¼å¼
cargo fmt

# 4. æ£€æŸ¥ä»£ç è´¨é‡
cargo clippy
```

### è°ƒè¯•æŠ€å·§

#### 1. ä½¿ç”¨æ—¥å¿—è°ƒè¯•

```rust
// åœ¨ä»£ç ä¸­æ·»åŠ è°ƒè¯•æ—¥å¿—
use log::{info, debug, error};

debug!("è°ƒè¯•ä¿¡æ¯: å˜é‡å€¼ = {}", variable);
info!("ä¿¡æ¯: æ“ä½œå®Œæˆ");
error!("é”™è¯¯: æ“ä½œå¤±è´¥");
```

#### 2. ä½¿ç”¨æµ‹è¯•è°ƒè¯•

```rust
#[test]
fn debug_test() {
    // ä½¿ç”¨println!åœ¨æµ‹è¯•ä¸­è¾“å‡ºè°ƒè¯•ä¿¡æ¯
    println!("è°ƒè¯•è¾“å‡º: {:?}", some_variable);
    
    // ä½¿ç”¨ --nocapture æŸ¥çœ‹è¾“å‡º
    // cargo test debug_test -- --nocapture
}
```

#### 3. åœ¨QEMUä¸­è°ƒè¯•

```bash
# 1. åœ¨TAä¸­æ·»åŠ è°ƒè¯•è¾“å‡º
# TEE_INFO("è°ƒè¯•ä¿¡æ¯: %s", debug_string);

# 2. æŸ¥çœ‹QEMUæ—¥å¿—
tail -f /tmp/serial.log

# 3. ä½¿ç”¨straceè·Ÿè¸ªCA
root@buildroot:/shared# strace ./your-ca-binary
```

### æ€§èƒ½åˆ†æ

```bash
# 1. è¿è¡Œæ€§èƒ½æµ‹è¯•
cargo test --release performance -- --nocapture

# 2. ä½¿ç”¨criterionè¿›è¡ŒåŸºå‡†æµ‹è¯•ï¼ˆå¦‚æœé…ç½®äº†ï¼‰
cargo bench

# 3. å†…å­˜ä½¿ç”¨åˆ†æ
valgrind ./target/debug/your-binary  # åœ¨Linuxä¸Š
```

---

## ğŸš€ å¼€å‘å·¥ä½œæµç¨‹

### æ—¥å¸¸å¼€å‘æµç¨‹

#### 1. å¼€å§‹æ–°åŠŸèƒ½å¼€å‘

```bash
# 1. æ›´æ–°ä»£ç åº“
git pull origin main

# 2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b feature/wallet-enhancement

# 3. æŸ¥çœ‹å½“å‰ä»»åŠ¡
# å‚è€ƒ TODO.md æˆ– GitHub Issues
```

#### 2. ä»£ç ä¿®æ”¹å’Œæµ‹è¯•

```bash
# 1. ä¿®æ”¹ä»£ç 
# ä½¿ç”¨æ‚¨å–œæ¬¢çš„IDEç¼–è¾‘ä»£ç 

# 2. è¿è¡Œç›¸å…³æµ‹è¯•
cargo test security::  # æµ‹è¯•å®‰å…¨æ¨¡å—
cargo test wallet::   # æµ‹è¯•é’±åŒ…æ¨¡å—

# 3. è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
cargo test --all-features
```

#### 3. åœ¨QEMUä¸­éªŒè¯

```bash
# 1. å¦‚æœä¿®æ”¹äº†TAç›¸å…³ä»£ç 
cd packages/ta-arm-trustzone
make clean && make

# 2. å¤åˆ¶åˆ°å…±äº«ç›®å½•
cp target/aarch64-unknown-optee/release/*.ta ../../../third_party/incubator-teaclave-trustzone-sdk/tests/shared/

# 3. åœ¨QEMUä¸­æµ‹è¯•
cd ../../../third_party/incubator-teaclave-trustzone-sdk/tests
./optee-qemuv8-fixed.sh aarch64-optee-4.7.0-qemuv8-ubuntu-24.04

# åœ¨QEMUä¸­ï¼š
root@buildroot:~# mount -t 9p -o trans=virtio host /shared
root@buildroot:~# cp /shared/*.ta /lib/optee_armtz/
root@buildroot:~# /shared/your-test-ca
```

#### 4. æäº¤ä»£ç 

```bash
# 1. æŸ¥çœ‹ä¿®æ”¹çŠ¶æ€
git status
git diff

# 2. æ·»åŠ ä¿®æ”¹çš„æ–‡ä»¶
git add packages/core-logic/src/wallet/new_feature.rs
git add packages/core-logic/src/wallet/mod.rs

# 3. æäº¤ä¿®æ”¹
git commit -m "feat: æ·»åŠ é’±åŒ…æ–°åŠŸèƒ½

- å®ç°æ–°çš„é’±åŒ…å¢å¼ºåŠŸèƒ½
- æ·»åŠ ç›¸åº”çš„å•å…ƒæµ‹è¯•
- é€šè¿‡QEMUç¯å¢ƒéªŒè¯"

# 4. æ¨é€åˆ°è¿œç¨‹åˆ†æ”¯
git push origin feature/wallet-enhancement
```

### ä»£ç å®¡æŸ¥æµç¨‹

#### 1. åˆ›å»ºPull Request

```bash
# 1. æ¨é€åˆ†æ”¯åï¼Œåœ¨GitHubåˆ›å»ºPR
# 2. å¡«å†™PRæ¨¡æ¿ï¼š
#    - åŠŸèƒ½æè¿°
#    - æµ‹è¯•ç»“æœ
#    - ç›¸å…³Issueé“¾æ¥
#    - æˆªå›¾æˆ–æ—¥å¿—è¾“å‡º
```

#### 2. ä»£ç å®¡æŸ¥æ£€æŸ¥æ¸…å•

åœ¨æäº¤PRå‰ï¼Œè¯·ç¡®ä¿ï¼š

- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼š`cargo test --all-features`
- [ ] ä»£ç æ ¼å¼æ­£ç¡®ï¼š`cargo fmt`
- [ ] æ²¡æœ‰ç¼–è¯‘è­¦å‘Šï¼š`cargo clippy`
- [ ] åœ¨QEMUç¯å¢ƒä¸­éªŒè¯è¿‡ï¼ˆå¦‚æœç›¸å…³ï¼‰
- [ ] æ·»åŠ äº†ç›¸åº”çš„å•å…ƒæµ‹è¯•
- [ ] æ›´æ–°äº†ç›¸å…³æ–‡æ¡£
- [ ] commitæ¶ˆæ¯æ¸…æ™°æè¿°äº†ä¿®æ”¹å†…å®¹

### CI/CDé›†æˆ

é¡¹ç›®é…ç½®äº†è‡ªåŠ¨åŒ–æµ‹è¯•ï¼š

```yaml
# .github/workflows/test.yml ç¤ºä¾‹
name: Tests
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
          submodules: recursive
      - name: Install Rust
        uses: actions-rs/toolchain@v1
      - name: Run tests
        run: cargo test --all-features
      - name: Run QEMU tests
        run: ./scripts/test_in_qemu.sh
```

---

## ğŸ“š ä»£ç è´¡çŒ®æŒ‡å—

### ä»£ç é£æ ¼å’Œçº¦å®š

#### 1. Rustä»£ç é£æ ¼

```rust
// âœ… å¥½çš„ä»£ç é£æ ¼
pub struct WalletManager {
    /// é’±åŒ…å­˜å‚¨
    wallets: HashMap<WalletId, WalletCore>,
    /// å®‰å…¨é…ç½®
    config: SecurityConfig,
}

impl WalletManager {
    /// åˆ›å»ºæ–°çš„é’±åŒ…ç®¡ç†å™¨
    pub fn new(config: SecurityConfig) -> Result<Self, SecurityError> {
        Ok(Self {
            wallets: HashMap::new(),
            config,
        })
    }
    
    /// åˆ›å»ºæ–°é’±åŒ…
    pub fn create_wallet(&mut self, params: WalletParams) -> Result<WalletId, SecurityError> {
        // å‚æ•°éªŒè¯
        self.validate_params(&params)?;
        
        // åˆ›å»ºé’±åŒ…
        let wallet = WalletCore::new(params)?;
        let wallet_id = wallet.id();
        
        // å­˜å‚¨é’±åŒ…
        self.wallets.insert(wallet_id, wallet);
        
        Ok(wallet_id)
    }
}
```

#### 2. é”™è¯¯å¤„ç†è§„èŒƒ

```rust
// âœ… ä½¿ç”¨ç»“æ„åŒ–é”™è¯¯å¤„ç†
use crate::error::SecurityError;

pub fn risky_operation() -> Result<String, SecurityError> {
    // æ˜ç¡®çš„é”™è¯¯ç±»å‹
    let data = read_sensitive_data()
        .map_err(|e| SecurityError::crypto_error("read_data", &e.to_string(), "wallet_manager"))?;
    
    Ok(data)
}

// âœ… åœ¨æµ‹è¯•ä¸­éªŒè¯é”™è¯¯
#[test]
fn test_error_handling() {
    let result = risky_operation();
    match result {
        Err(SecurityError::CryptoError { operation, .. }) => {
            assert_eq!(operation, "read_data");
        }
        _ => panic!("æœŸæœ›CryptoError"),
    }
}
```

#### 3. æµ‹è¯•è§„èŒƒ

```rust
#[cfg(test)]
mod tests {
    use super::*;
    
    #[test]
    fn test_wallet_creation_success() {
        // å‡†å¤‡æµ‹è¯•æ•°æ®
        let config = SecurityConfig::default();
        let mut manager = WalletManager::new(config).unwrap();
        
        let params = WalletParams {
            name: "test_wallet".to_string(),
            chain_id: 1,
        };
        
        // æ‰§è¡Œæµ‹è¯•
        let wallet_id = manager.create_wallet(params).unwrap();
        
        // éªŒè¯ç»“æœ
        assert!(!wallet_id.is_empty());
        assert_eq!(manager.wallets.len(), 1);
    }
    
    #[test]
    fn test_wallet_creation_invalid_params() {
        // æµ‹è¯•é”™è¯¯æƒ…å†µ
        let config = SecurityConfig::default();
        let mut manager = WalletManager::new(config).unwrap();
        
        let invalid_params = WalletParams {
            name: "".to_string(), // æ— æ•ˆåç§°
            chain_id: 0,          // æ— æ•ˆé“¾ID
        };
        
        // éªŒè¯é”™è¯¯å¤„ç†
        let result = manager.create_wallet(invalid_params);
        assert!(result.is_err());
    }
}
```

### æ–‡æ¡£ç¼–å†™è§„èŒƒ

#### 1. ä»£ç æ–‡æ¡£

```rust
/// é’±åŒ…ç®¡ç†å™¨
/// 
/// æä¾›é’±åŒ…çš„åˆ›å»ºã€ç®¡ç†å’Œå®‰å…¨æ“ä½œåŠŸèƒ½ã€‚æ‰€æœ‰æ“ä½œéƒ½ç»è¿‡å®‰å…¨éªŒè¯ï¼Œ
/// ç§é’¥æ°¸è¿œä¸ä¼šç¦»å¼€TEEç¯å¢ƒã€‚
/// 
/// # ç¤ºä¾‹
/// 
/// ```rust
/// let config = SecurityConfig::default();
/// let mut manager = WalletManager::new(config)?;
/// 
/// let params = WalletParams::new("my_wallet", 1);
/// let wallet_id = manager.create_wallet(params)?;
/// ```
/// 
/// # å®‰å…¨æ³¨æ„äº‹é¡¹
/// 
/// - æ‰€æœ‰é’±åŒ…æ“ä½œéƒ½éœ€è¦é€šè¿‡TEEéªŒè¯
/// - ç§é’¥å­˜å‚¨åœ¨ç¡¬ä»¶å®‰å…¨å­˜å‚¨ä¸­
/// - æ”¯æŒå¤šé‡ç­¾åéªŒè¯
pub struct WalletManager {
    // ...
}
```

#### 2. READMEå’Œæ–‡æ¡£æ›´æ–°

```markdown
## æ–°åŠŸèƒ½ï¼šå¢å¼ºé’±åŒ…ç®¡ç†

### åŠŸèƒ½æè¿°

æ–°å¢äº†å¢å¼ºå‹é’±åŒ…ç®¡ç†å™¨ï¼Œæ”¯æŒï¼š
- æ‰¹é‡é’±åŒ…æ“ä½œ
- é«˜çº§å®‰å…¨ç­–ç•¥
- æ€§èƒ½ä¼˜åŒ–çš„SIMDæ“ä½œ

### ä½¿ç”¨ç¤ºä¾‹

\```rust
use airaccount_core_logic::wallet::EnhancedWalletManager;

let manager = EnhancedWalletManager::new(config)?;
let wallets = manager.create_batch_wallets(params_list)?;
\```

### æµ‹è¯•éªŒè¯

\```bash
cargo test wallet::enhanced_wallet_manager
\```
```

### æäº¤ä¿¡æ¯è§„èŒƒ

ä½¿ç”¨[Conventional Commits](https://www.conventionalcommits.org/)æ ¼å¼ï¼š

```bash
# åŠŸèƒ½æ·»åŠ 
git commit -m "feat(wallet): æ·»åŠ æ‰¹é‡é’±åŒ…åˆ›å»ºåŠŸèƒ½

- æ”¯æŒä¸€æ¬¡åˆ›å»ºå¤šä¸ªé’±åŒ…
- ä¼˜åŒ–å†…å­˜ä½¿ç”¨
- æ·»åŠ ç›¸åº”å•å…ƒæµ‹è¯•

Closes #123"

# Bugä¿®å¤
git commit -m "fix(security): ä¿®å¤å†…å­˜æ³„æ¼é—®é¢˜

- åœ¨å®‰å…¨å†…å­˜åˆ†é…ä¸­æ­£ç¡®æ¸…ç†èµ„æº
- æ·»åŠ å†…å­˜æ³„æ¼æ£€æµ‹æµ‹è¯•
- é€šè¿‡valgrindéªŒè¯

Fixes #456"

# æ–‡æ¡£æ›´æ–°
git commit -m "docs: æ›´æ–°QEMUç¯å¢ƒæ­å»ºæŒ‡å—

- æ·»åŠ macOSç‰¹å®šé…ç½®è¯´æ˜
- æ›´æ–°ä¾èµ–å®‰è£…å‘½ä»¤
- ä¿®æ­£ç¤ºä¾‹ä»£ç é”™è¯¯"
```

---

## ğŸ”— ç›¸å…³æ–‡æ¡£é“¾æ¥

### é¡¹ç›®æ ¸å¿ƒæ–‡æ¡£

- [é¡¹ç›®æ¶æ„è®¾è®¡](./Solution.md) - äº†è§£æ•´ä½“æŠ€æœ¯æ–¹æ¡ˆ
- [éƒ¨ç½²æŒ‡å—](./Deploy_zh.md) - ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²è¯´æ˜
- [TEEå¼€å‘æŒ‡å—](./TEE-Development-Guide.md) - æ·±å…¥çš„TEEå¼€å‘æ•™ç¨‹
- [å®‰å…¨è¯„ä¼°æŠ¥å‘Š](./Security_Assessment_Report.md) - å®‰å…¨ç‰¹æ€§è¯¦ç»†è¯´æ˜

### æŠ€æœ¯æ ˆæ–‡æ¡£

- [Apache Teaclave TrustZone SDK](https://teaclave.apache.org/) - TEEå¼€å‘æ¡†æ¶
- [OP-TEE Documentation](https://optee.readthedocs.io/) - OP-TEEå®˜æ–¹æ–‡æ¡£
- [QEMU ARM System Emulation](https://www.qemu.org/docs/master/system/arm/virt.html) - QEMU ARMè™šæ‹ŸåŒ–
- [Rust TEE Programming](https://rust-lang.org/) - Rustè¯­è¨€å®˜æ–¹æ–‡æ¡£

### å¼€å‘å·¥å…·

- [Visual Studio Code](https://code.visualstudio.com/) + [Rust Analyzer](https://rust-analyzer.github.io/)
- [CLion](https://www.jetbrains.com/clion/) - JetBrainsçš„Rust IDE
- [Rustè¯­è¨€æœåŠ¡å™¨](https://github.com/rust-lang/rls) - ç¼–è¾‘å™¨é›†æˆ

---

## ğŸ†˜ å¸¸è§é—®é¢˜å’Œæ•…éšœæ’é™¤

### QEMUç›¸å…³é—®é¢˜

#### é—®é¢˜1ï¼šQEMUå¯åŠ¨å¤±è´¥
```bash
# ç—‡çŠ¶ï¼šqemu-system-aarch64: command not found
# è§£å†³æ–¹æ¡ˆï¼š
brew install qemu  # macOS
sudo apt install qemu-system-arm  # Ubuntu

# éªŒè¯å®‰è£…ï¼š
qemu-system-aarch64 --version
```

#### é—®é¢˜2ï¼šå…±äº«ç›®å½•æŒ‚è½½å¤±è´¥
```bash
# ç—‡çŠ¶ï¼šmount: mounting host on /shared failed
# è§£å†³æ–¹æ¡ˆï¼š
# 1. ç¡®ä¿å…±äº«ç›®å½•å­˜åœ¨
mkdir -p third_party/incubator-teaclave-trustzone-sdk/tests/shared

# 2. æ£€æŸ¥QEMUå¯åŠ¨å‚æ•°
grep "virtio-9p" optee-qemuv8-fixed.sh

# 3. åœ¨QEMUä¸­é‡æ–°æŒ‚è½½
mount -t 9p -o trans=virtio,version=9p2000.L host /shared
```

#### é—®é¢˜3ï¼šTAåŠ è½½å¤±è´¥
```bash
# ç—‡çŠ¶ï¼šError: Failed to open session with the TA
# è§£å†³æ–¹æ¡ˆï¼š
# 1. æ£€æŸ¥TAæ–‡ä»¶æ˜¯å¦æ­£ç¡®å¤åˆ¶
ls -la /lib/optee_armtz/

# 2. æ£€æŸ¥TAæ–‡ä»¶æ ¼å¼
file /lib/optee_armtz/*.ta
# åº”è¯¥æ˜¾ç¤ºï¼šdata

# 3. æ£€æŸ¥UUIDåŒ¹é…
grep -r "11223344-5566-7788" .
```

### ç¼–è¯‘ç›¸å…³é—®é¢˜

#### é—®é¢˜1ï¼šä¾èµ–é¡¹å®‰è£…å¤±è´¥
```bash
# ç—‡çŠ¶ï¼šCould not find system library 'xxx' required by the 'yyy' crate
# è§£å†³æ–¹æ¡ˆ - macOSï¼š
brew install openssl libffi

# è§£å†³æ–¹æ¡ˆ - Ubuntuï¼š
sudo apt install libssl-dev libffi-dev pkg-config
```

#### é—®é¢˜2ï¼šäº¤å‰ç¼–è¯‘å¤±è´¥
```bash
# ç—‡çŠ¶ï¼šlinker `aarch64-linux-gnu-gcc` not found
# è§£å†³æ–¹æ¡ˆï¼š
rustup target add aarch64-unknown-linux-gnu
# æˆ–è€…å®‰è£…äº¤å‰ç¼–è¯‘å·¥å…·é“¾
```

#### é—®é¢˜3ï¼šæµ‹è¯•è¶…æ—¶
```bash
# ç—‡çŠ¶ï¼štest has been running for over 60 seconds
# è§£å†³æ–¹æ¡ˆï¼š
# 1. å•ç‹¬è¿è¡Œè€—æ—¶æµ‹è¯•
cargo test test_statistics -- --nocapture

# 2. è®¾ç½®æµ‹è¯•è¶…æ—¶
RUST_TEST_TIME_INTEGRATION=300 cargo test

# 3. è·³è¿‡è€—æ—¶æµ‹è¯•
cargo test -- --skip test_statistics
```

### å¼€å‘ç¯å¢ƒé—®é¢˜

#### é—®é¢˜1ï¼šGitå­æ¨¡å—é—®é¢˜
```bash
# ç—‡çŠ¶ï¼šSubmodule path 'third_party/...' not initialized
# è§£å†³æ–¹æ¡ˆï¼š
git submodule update --init --recursive

# å¼ºåˆ¶é‡æ–°åˆå§‹åŒ–ï¼š
git submodule deinit --all -f
git submodule update --init --recursive
```

#### é—®é¢˜2ï¼šæƒé™é—®é¢˜
```bash
# ç—‡çŠ¶ï¼šPermission denied
# è§£å†³æ–¹æ¡ˆï¼š
# 1. æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la third_party/incubator-teaclave-trustzone-sdk/tests/shared/

# 2. ä¿®æ­£æƒé™
chmod +x your-binary-file

# 3. åœ¨QEMUä¸­è®¾ç½®æƒé™
chmod +x /shared/your-binary
```

### æ€§èƒ½é—®é¢˜

#### é—®é¢˜1ï¼šQEMUè¿è¡Œç¼“æ…¢
```bash
# è§£å†³æ–¹æ¡ˆï¼š
# 1. å¢åŠ CPUæ ¸å¿ƒæ•°
# ä¿®æ”¹optee-qemuv8-fixed.shä¸­çš„ -smp å‚æ•°

# 2. å¢åŠ å†…å­˜
# ä¿®æ”¹ -m å‚æ•°ä¸ºæ›´å¤§å€¼

# 3. å¯ç”¨ç¡¬ä»¶åŠ é€Ÿï¼ˆå¦‚æœæ”¯æŒï¼‰
# æ·»åŠ  -enable-kvm å‚æ•°ï¼ˆLinuxä¸»æœºï¼‰
```

#### é—®é¢˜2ï¼šç¼–è¯‘æ—¶é—´è¿‡é•¿
```bash
# è§£å†³æ–¹æ¡ˆï¼š
# 1. ä½¿ç”¨releaseæ¨¡å¼ç¼–è¯‘
cargo build --release

# 2. å¹¶è¡Œç¼–è¯‘
export CARGO_BUILD_JOBS=$(nproc)

# 3. ä½¿ç”¨sccacheåŠ é€Ÿ
cargo install sccache
export RUSTC_WRAPPER=sccache
```

---

## ğŸ“ è·å–å¸®åŠ©

### å†…éƒ¨èµ„æº

- **æŠ€æœ¯æ–‡æ¡£**ï¼šæŸ¥çœ‹ `docs/` ç›®å½•ä¸‹çš„è¯¦ç»†æ–‡æ¡£
- **ä»£ç ç¤ºä¾‹**ï¼šå‚è€ƒ `third_party/incubator-teaclave-trustzone-sdk/examples/`
- **æµ‹è¯•ç”¨ä¾‹**ï¼šå­¦ä¹  `packages/core-logic/src/*/tests/` ä¸­çš„æµ‹è¯•

### å¤–éƒ¨èµ„æº

- **OP-TEEç¤¾åŒº**ï¼š[OP-TEE GitHub](https://github.com/OP-TEE/optee_os)
- **Teaclaveç¤¾åŒº**ï¼š[Apache Teaclave](https://github.com/apache/incubator-teaclave)
- **Rustç¤¾åŒº**ï¼š[Rust Users Forum](https://users.rust-lang.org/)

### æŠ¥å‘Šé—®é¢˜

åœ¨æŠ¥å‘Šé—®é¢˜æ—¶ï¼Œè¯·åŒ…å«ï¼š

1. **ç¯å¢ƒä¿¡æ¯**ï¼š
   ```bash
   uname -a
   rustc --version
   qemu-system-aarch64 --version
   ```

2. **é”™è¯¯æ—¥å¿—**ï¼šå®Œæ•´çš„é”™è¯¯è¾“å‡ºå’Œå †æ ˆè·Ÿè¸ª

3. **é‡ç°æ­¥éª¤**ï¼šè¯¦ç»†çš„æ“ä½œæ­¥éª¤

4. **æœŸæœ›ç»“æœ**ï¼šæ‚¨æœŸæœ›çœ‹åˆ°çš„ç»“æœ

---

## ğŸ‰ æ¬¢è¿åŠ å…¥AirAccounté¡¹ç›®ï¼

é€šè¿‡æœ¬æŒ‡å—ï¼Œæ‚¨åº”è¯¥å·²ç»ï¼š

âœ… ç†è§£äº†AirAccounté¡¹ç›®çš„æ¶æ„å’Œç›®æ ‡  
âœ… æ­å»ºäº†å®Œæ•´çš„å¼€å‘ç¯å¢ƒ  
âœ… æˆåŠŸè¿è¡Œäº†QEMU+OP-TEEæ¨¡æ‹Ÿç¯å¢ƒ  
âœ… å®Œæˆäº†ç¬¬ä¸€æ¬¡æµ‹è¯•è¿è¡Œ  
âœ… äº†è§£äº†æ—¥å¸¸å¼€å‘å·¥ä½œæµç¨‹  
âœ… æŒæ¡äº†ä»£ç è´¡çŒ®è§„èŒƒ

ç°åœ¨æ‚¨å·²ç»å‡†å¤‡å¥½ä¸ºè¿™ä¸ªexcitingçš„TEEé¡¹ç›®åšå‡ºè´¡çŒ®äº†ï¼

### ä¸‹ä¸€æ­¥å»ºè®®

1. **æ·±å…¥å­¦ä¹ **ï¼šé˜…è¯»[å®‰å…¨è¯„ä¼°æŠ¥å‘Š](./Security_Assessment_Report.md)äº†è§£å®‰å…¨è®¾è®¡
2. **å®è·µç»ƒä¹ **ï¼šå°è¯•ä¿®æ”¹ä¸€ä¸ªå°åŠŸèƒ½å¹¶æäº¤PR
3. **å‚ä¸è®¨è®º**ï¼šåŠ å…¥é¡¹ç›®çš„æŠ€æœ¯è®¨è®ºå’Œä»£ç å®¡æŸ¥
4. **æŒç»­å­¦ä¹ **ï¼šè·Ÿä¸ŠTEEå’ŒåŒºå—é“¾æŠ€æœ¯çš„æœ€æ–°å‘å±•

**Happy Coding! ğŸš€**

---

*æœ€åæ›´æ–°ï¼š2025å¹´1æœˆ*  
*æ–‡æ¡£ç‰ˆæœ¬ï¼šv1.0*  
*é€‚ç”¨é¡¹ç›®ç‰ˆæœ¬ï¼šAirAccount v1.0-PRODUCTION-READY*