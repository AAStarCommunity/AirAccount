# AirAccount测试文档

本目录包含AirAccount项目的所有测试相关文档。

## 📁 文档结构

```
docs/test/
├── README.md                           # 本文档 - 测试文档索引
└── account_lifecycle_test_cases.md     # 账户生命周期测试用例
```

## 📋 测试文档说明

### account_lifecycle_test_cases.md
**完整的账户生命周期测试用例文档**

涵盖AirAccount系统的核心测试场景：

#### 🔐 用户认证测试
- **WebAuthn注册**: 生物识别/安全密钥注册流程
- **身份验证**: 用户登录和会话管理
- **多因素认证**: 结合Passkey的安全认证

#### 💳 账户管理测试  
- **TEE账户创建**: 硬件环境中的安全钱包创建
- **私钥管理**: TEE中的密钥生成和存储
- **地址计算**: 以太坊地址生成和验证

#### 💰 资金操作测试
- **资金接收**: Anvil测试链的资金发送和接收
- **余额查询**: TEE和区块链的余额同步验证  
- **转账交易**: TEE签名的转账操作测试

#### 🔐 安全专项测试
- **TEE隔离**: 私钥安全隔离验证
- **签名安全**: 硬件随机数和防重放保护
- **内存保护**: 敏感数据的安全处理

#### ⚡ 性能基准测试
- **操作延迟**: 账户创建、查询、签名性能
- **并发处理**: 多用户同时操作压力测试
- **稳定性**: 长期运行和错误恢复测试

#### 🔗 集成测试
- **端到端流程**: 完整用户生命周期验证
- **多CA兼容**: Rust CA和Node.js CA功能对比
- **区块链集成**: Anvil本地链的完整交互测试

## 🚀 测试执行指南

### 快速开始
```bash
# 进入项目根目录
cd /path/to/AirAccount

# 运行完整生命周期测试
./scripts/test/run-complete-test.sh

# 运行SDK集成测试
npm run --prefix packages/airaccount-sdk-test lifecycle

# 运行多用户演示
npm run --prefix packages/airaccount-sdk-test demo-blockchain
```

### 环境要求
- **OP-TEE环境**: QEMU ARMv8 + OP-TEE 4.7
- **区块链**: Anvil本地测试链
- **CA服务**: Node.js CA (端口3002) + Rust CA (端口3001,可选)
- **依赖**: Foundry工具链，Node.js 16+

### 测试验证
```bash
# 验证测试脚本
./scripts/test/validate-test-scripts.sh

# 健康检查
./scripts/test/tee-health-check.sh

# Docker环境测试
./scripts/test/test-docker-tee.sh
```

## 📊 测试覆盖范围

| 测试类别 | 覆盖功能 | 测试用例数 | 自动化程度 |
|---------|----------|-----------|-----------|
| 用户认证 | WebAuthn注册/登录 | 8+ | 90% |
| 账户管理 | TEE钱包创建/查询 | 12+ | 95% |
| 资金操作 | 转账/余额/接收 | 15+ | 85% |
| 安全验证 | TEE隔离/签名安全 | 10+ | 80% |
| 性能测试 | 延迟/吞吐/并发 | 8+ | 100% |
| 集成测试 | 端到端流程 | 6+ | 90% |

**总计**: 59+ 测试用例，平均自动化程度 90%

## 🔍 测试策略

### 测试金字塔
```
    /\     E2E集成测试 (10%)
   /  \    
  /____\   API接口测试 (30%)
 /_____\   
/_______\  单元测试 (60%)
```

### 测试类型分布
- **单元测试**: 组件级功能验证
- **集成测试**: 模块间协作验证  
- **系统测试**: 完整场景流程验证
- **性能测试**: 非功能性需求验证
- **安全测试**: 威胁模型对应验证

### 质量门禁
- **代码覆盖率**: >85%
- **测试通过率**: >95%  
- **性能基线**: 关键操作<500ms
- **安全扫描**: 无高危漏洞
- **用户验收**: 核心场景100%通过

## 🛠️ 测试工具链

### 自动化框架
- **Rust测试**: `cargo test` + 自定义测试框架
- **JavaScript测试**: Node.js + 自定义SDK模拟器
- **集成测试**: Shell脚本 + Docker容器
- **性能测试**: 自定义基准测试工具

### 测试环境
- **开发环境**: 本地macOS/Linux + QEMU
- **CI环境**: Docker容器 + GitHub Actions  
- **预发布环境**: 真实ARM硬件 + OP-TEE
- **生产验证**: Raspberry Pi 5 + 硬件TEE

### 监控和报告
- **测试报告**: 自动生成HTML/Markdown报告
- **覆盖率报告**: 代码覆盖统计和可视化
- **性能趋势**: 历史性能数据对比
- **缺陷跟踪**: 自动化issue创建和更新

## 📚 相关文档

- [项目测试指南](../TESTING_GUIDE.md) - 完整测试执行说明
- [测试策略文档](../TESTING_STRATEGY.md) - 测试方法和策略  
- [脚本组织说明](../../scripts/SCRIPTS_ORGANIZATION.md) - 测试脚本使用指南
- [Docker测试环境](../../docker/DOCKER_ORGANIZATION.md) - 容器化测试环境

## 🤝 贡献指南

### 添加新测试用例
1. 在对应分类下添加测试用例编号和描述
2. 包含完整的测试步骤和预期结果
3. 提供测试数据和验证标准
4. 更新测试覆盖统计

### 测试用例命名规范
- **TC-{模块}-{序号}**: 如 `TC-REG-001`
- **模块代码**: REG(注册), ACC(账户), FUND(资金), TX(交易), SEC(安全), PERF(性能), INT(集成)
- **序号**: 三位数字，从001开始

### 文档维护
- 定期更新测试用例状态
- 同步最新的功能变更  
- 记录测试执行历史
- 更新性能基准数据

---

*📅 最后更新: 2025-01-15*  
*🏷️ 版本: v2.0*  
*📊 测试用例总数: 59+*